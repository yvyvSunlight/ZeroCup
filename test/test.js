const data=[
    {
        id:1,
        question:'当你遇到新朋友时，你',
        optionA:'说话的时间与聆听的时间相当。',
        optionB:'聆听的时间会比说话的时间多。',
        },
        {
        id:2,
        question:'下列哪一种是你的一般生活取向？',
        optionA:'只管做吧。',
        optionB:'找出多种不同选择。',
        },
        {
        id:3,
        question:'你喜欢自己的哪种性格？',
        optionA:'冷静而理性。',
        optionB:'热情而体谅。',
        },
        {
        id:4,
        question:'你擅长:',
        optionA:'在有需要时间时同时协调进行多项工作。',
        optionB:'专注在某一项工作上，直至把它完成为止。',
        },
        {
        id:5,
        question:'你参与社交聚会时:',
        optionA:'总是能认识新朋友。',
        optionB:'只跟几个亲密挚友呆在一起。',
        },
        {
        id:6,
        question:'当你尝试了解某些事情时，一般你会:',
        optionA:'先要了解细节。',
        optionB:'先了解整体情况，细节容后再谈。',
        },
        {
        id:7,
        question:'你对下列哪方面较感兴趣？',
        optionA:'知道别人的想法。',
        optionB:'知道别人的感受。',
        },
        {
        id:8,
        question:'你较喜欢下列哪个工作？',
        optionA:'能让你迅速和即时做出反应。',
        optionB:'能让你定出目标，然后逐步达成目标的工作。',
        },
        {
        id:9,
        question:'你更符合以下哪种说法：',
        optionA:'当我与友人尽兴后，我会感到精力充沛，并会继续追求这种欢娱。',
        optionB:'当我与友人尽兴后，我会感到疲累，觉得需要一些空间。',
        },
        {
        id:10,
        question:'你更符合以下哪种说法：',
        optionA:'我较有兴趣知道别人的经历，例如他们做过什么？认识什么人？',
        optionB:'我较有兴趣知道别人的计划和梦想，例如他们会往哪里去？憧憬什么？',
        },
        {
        id:11,
        question:'你更符合以下哪种说法：',
        optionA:'我擅长订出一些可行的计划。',
        optionB:'我擅长促成别人同意一些计划，并衷力合作。',
        },
        {
        id:12,
        question:'你更符合以下哪种说法：',
        optionA:'我会突然尝试做某些事，看看会有什么事情发生。',
        optionB:'我尝试做任何事前，都想事先知道可能有什么事情发生。',
        },
        {
        id:13,
        question:'你更符合以下哪种说法：',
        optionA:'我经常边说话，边思考。',
        optionB:'我在说话前，通常会思考要说的话。',
        },
        {
        id:14,
        question:'你更符合以下哪种说法：',
        optionA:'四周的实际环境对我很重要，而且会影响我的感受。',
        optionB:'如果我喜欢所做的事情，气氛对我而言并不是那么重要。',
        },
        {
        id:15,
        question:'你更符合以下哪种说法：',
        optionA:'我喜欢分析，心思缜密。',
        optionB:'我对人感兴趣，关心他们所发生的事。',
        },
        {
        id:16,
        question:'你更符合以下哪种说法：',
        optionA:'即使已出计划，我也喜欢探讨其他新的方案。',
        optionB:'一旦定出计划，我便希望能依计行事。',
        },
        {
        id:17,
        question:'你更符合以下哪种说法：',
        optionA:'认识我的人，一般都知道什么对我来说是重要的。',
        optionB:'除了我感觉亲近的人，我不会对人说出什么对我来说是重要的。',
        },
        {
        id:18,
        question:'你更符合以下哪种说法：',
        optionA:'如果我喜欢某种活动，我会经常进行这种活动。',
        optionB:'我一旦熟悉某种活动后，便希望转而尝试其它新的活动。',
        },
        {
        id:19,
        question:'你更符合以下哪种说法：',
        optionA:'当我作决定的时候，我更多地考虑正反两面的观点，并且会推理与质证。',
        optionB:'当我作决定的时候，我会更多地了解其他人的想法，并希望能够达成共识。',
        },
        {
        id:20,
        question:'你更符合以下哪种说法：',
        optionA:'当我专注做某件事情时，需要不时停下来休息。',
        optionB:'当我专注做某件事情时，不希望受到任何干扰。',
        },
        {
        id:21,
        question:'你更符合以下哪种说法：',
        optionA:'我独处太久，便会感到不安。',
        optionB:'若没有足够的自处时间，我便会感到烦躁不安。',
        },
        {
        id:22,
        question:'你更符合以下哪种说法：',
        optionA:'我对一些没有实际用途的意念不感兴趣。',
        optionB:'我喜欢意念本身，并享受想象意念的过程。',
        },
        {
        id:23,
        question:'你更符合以下哪种说法：',
        optionA:'当进行谈判时，我依靠自己的知识和技巧。',
        optionB:'当进行谈判时，我会拉拢其他人至同一阵线。',
        },
        {
        id:24,
        question:'你更符合以下哪种说法：',
        optionA:'随遇而安，做当时想做的事。',
        optionB:'为想做的事情订出时间表。',
        },
        {
        id:25,
        question:'你更符合以下哪种说法：',
        optionA:'花多些时间与别人共度。',
        optionB:'花多些时间自己阅读、散步或者发白日梦。',
        },
        {
        id:26,
        question:'你更符合以下哪种说法：',
        optionA:'返回你喜欢的地方度假。',
        optionB:'选择前往一些你从未到达的地方。',
        },
        {
        id:27,
        question:'你更符合以下哪种说法：',
        optionA:'带着一些与工作或学校有关的事情。',
        optionB:'处理一些对你重要的人际关系。',
        },
        {
        id:28,
        question:'你更符合以下哪种说法：',
        optionA:'忘记平时发生的事情，专心享乐。',
        optionB:'想着假期过后要准备的事情。',
        },
        {
        id:29,
        question:'你更符合以下哪种说法：',
        optionA:'参观著名景点。',
        optionB:'花时间逛博物馆和一些较为幽静的地方。',
        },
        {
        id:30,
        question:'你更符合以下哪种说法：',
        optionA:'在喜欢的餐厅用膳。',
        optionB:'尝试新的菜式。',
        },
        {
        id:31,
        question:'你更符合以下哪种说法：',
        optionA:'别人认为我会公正处事，并且尊重他人。',
        optionB:'别人相信在他们有需要时，我会在他们身边。',
        },
        {
        id:32,
        question:'你更符合以下哪种说法：',
        optionA:'随机应变。',
        optionB:'按照计划行事。',
        },
        {
        id:33,
        question:'你更符合以下哪种说法：',
        optionA:'坦率。',
        optionB:'深沉。',
        },
        {
        id:34,
        question:'你更符合以下哪种说法：',
        optionA:'留意事实。',
        optionB:'注重事实。',
        },
        {
        id:35,
        question:'你更符合以下哪种说法：',
        optionA:'知识广博。',
        optionB:'善解人意。',
        },
        {
        id:36,
        question:'你更符合以下哪种说法：',
        optionA:'容易适应转变。',
        optionB:'处事井井有条。',
        },
        {
        id:37,
        question:'你更符合以下哪种说法：',
        optionA:'爽朗。',
        optionB:'沉稳。',
        },
        {
        id:38,
        question:'你更符合以下哪种说法：',
        optionA:'实事求是。',
        optionB:'富想象力。',
        },
        {
        id:39,
        question:'你更符合以下哪种说法：',
        optionA:'喜欢询问实情。',
        optionB:'喜欢探索感受。',
        },
        {
        id:40,
        question:'你更符合以下哪种说法：',
        optionA:'不断接受新意见。',
        optionB:'着眼达成目标。',
        },
        {
        id:41,
        question:'你更符合以下哪种说法：',
        optionA:'率直。',
        optionB:'内敛。',
        },
        {
        id:42,
        question:'你更符合以下哪种说法：',
        optionA:'实事求是。',
        optionB:'具远大目光。',
        },
        {
        id:43,
        question:'你更符合以下哪种说法：',
        optionA:'公正。',
        optionB:'宽容。',
        },
        {
        id:44,
        question:'你更符合以下哪种说法：',
        optionA:'暂时放下不愉快的事情，直至有心情时才处理。',
        optionB:'及时处理不愉快的事情，务求把它们抛诸脑后。',
        },
        {
        id:45,
        question:'你更符合以下哪种说法：',
        optionA:'自己的工作被欣赏，即使你自己并不满意。',
        optionB:'创造一些有长远价值的东西，但不一定需在别人知道是你做的。',
        },
        {
        id:46,
        question:'你更符合以下哪种说法：',
        optionA:'在自己有兴趣的范畴，积累丰富的经验。',
        optionB:'有各式各样不同的经验。',
        },
        {
        id:47,
        question:'你更符合以下哪种说法：',
        optionA:'感情用事的人较容易犯错。',
        optionB:'逻辑思维会令人自以为是，因而容易犯错。',
        },
        {
        id:48,
        question:'你更符合以下哪种说法：',
        optionA:'犹豫不决必失败。',
        optionB:'三思而后行。',
        },
];


//导航栏w


// alert(window.innerWidth)
//测试控制器部分
const totalQ=48;
var requiredQ=12;
//完整48 ，建议24， 自定义：4的倍数

//获取题目库
function GetRandom(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
}

var idQ=new Array();
var cntId=0;
function generateQ()
{
    var visited =new Array();
    for(let i=0;i<12;i++)
    {
        visited[i]=0;
    } 
    while(cntId<requiredQ)
    {
        let positionQ=GetRandom(0,11);
        if(visited[positionQ]==0)
        {
            visited[positionQ]=1;
            for(let k=1;k<=4;k++)
            {
                idQ[++cntId]=positionQ*4+k;
                // console.log('s');
                // console.log(idQ[cntId]);
            }
        }
    }
}





var Xway=1,Yway=1
//stary night 启动!
var canvas=document.getElementById("canvas");
var ctx=canvas.getContext("2d");
canvas.width=window.innerWidth
canvas.height=window.innerHeight
var meteors = []
var stars=100
var dtystars=1

function newmeteor(){
    let a=GetRandom(0,255),b=GetRandom(0,255),c=GetRandom(0,255);
        // alert("c"+a+","+b+","+c)
    meteors.push({
        lines:[{
            x:parseInt(Math.random()*canvas.width),
            y:parseInt(Math.random()*canvas.height),
        }],
        life:parseInt(Math.random()*200)+200,
        age:0,
        color:{
            R:a,
            G:b,
            B:c,
        },
        starsize:{
            w:1,
            h:1,
        },
        speed:{
            x:1,
            y:1,
        },
        tag:1,
    })
}
function dtynewmeteor(){
    meteors.push({
        lines:[{
            x:parseInt(GetRandom(0.2,0.4)*canvas.width),
            y:parseInt(GetRandom(-0.4,-0.2)*canvas.height),
        }],
        life:parseInt(Math.random()*600)+1000,
        age:0,
        color:{
            R:255,
            G:255,
            B:255,
        },
        starsize:{
            w:2,
            h:2,
        },
        speed:{
            x:3,
            y:2,
        },
        tag:2,
    })
}

function init()
{
    for(let i=0;i<stars;i++)
    {
        newmeteor();
    }
    // dtynewmeteor();
}

function draw()
{
    ctx.clearRect(0,0,canvas.width,canvas.height)
    for(let i=0;i<meteors.length;i++)
    {
        let meteor=meteors[i]
        lines=meteor.lines
        // alert(meteor.color.R)
        for(let j=0;j< lines.length;j++)
        {
            // ctx.fillStyle="rgb(255,255,255,"+j/lines.length+")"
            ctx.fillStyle="rgb("+meteor.color.R+","+meteor.color.G+","+meteor.color.B+","+j/lines.length+")";
            ctx.fillRect(lines[j].x,lines[j].y,meteor.starsize.w,meteor.starsize.h);
        }
        // ctx.fillStyle="rgb("+meteor.color.R+","+meteor.color.G+","+meteor.color.B+","+j/lines.length+")";
        ctx.fillStyle="white"
        var star=lines[lines.length-1]
        ctx.fillRect(star.x,star.y,meteor.starsize.w*2,meteor.starsize.h*2)
        if(meteor.age<=meteor.life/2)
        {
            lines.push({
                x:star.x+Xway*meteor.speed.x,
                y:star.y+Yway*meteor.speed.y,
            })
        }
        else
        {
            lines.shift()
        }
        meteor.age++;
        if(meteor.age>=meteor.life)
        {
            meteors.splice(i,1)
            if(meteor.tag==1)
                newmeteor();
            else
                dtynewmeteor();
        }
    }
}
init()
setInterval(draw,1)







//题目启动!
var header=document.getElementsByClassName("header");
var launch=document.getElementById("launch");
var title=document.getElementById("title");
var question_sum_box=document.getElementById("question-sum-box");
var easymod=document.getElementById("easymod");
var fullmod=document.getElementById("fullmod");
var self_define_mod=document.getElementById("self-define-mod");
var dtyin=document.getElementById("dtyin");
var start=document.getElementById("start");
var qidong=document.getElementById("qidong");
var button = document.querySelector(".back");


easymod.addEventListener("click",function(){
    requiredQ=12;
    start_one();
    button.style.display = "block";
})
fullmod.addEventListener("click",()=>{
    requiredQ=48;
    start_one();
    button.style.display = "block";
})
self_define_mod.addEventListener("click",function(){
    requiredQ=parseInt((parseInt(dtyin.value)-1)/4)*4+4;
    if(requiredQ>0&&requiredQ<=48)
        start_one();
        button.style.display = "block";
    })

var cubu=document.getElementById("cubu");

function start_one()
{
    launch.style.animation="dedrawing 2s forwards";
    question_sum_box.style.animation="fadeout 2s forwards";
    header[0].style.animation="fadeout 2s forwards";
    setTimeout(() => {
    header[0].style.display="none";
    launch.style.display="none";
    question_sum_box.style.display="none";
    start.style.animation="drawing 2s forwards";
    start.style.display="block";
    cubu.style.animation="fadein 2s forwards";
    cubu.classList.remove("discubu");
    }, 2000);
}

var cububu=document.getElementById("cububu");
function QIDONG(){
    qidong.removeEventListener("click",QIDONG);
    start.style.animation="dedrawing 2s forwards";
    setTimeout(function(){
        start.style.display="none";
        test();
    }, 2000);
}
qidong.addEventListener("click",QIDONG);



function setP(a,x,y)
{
    a.style.left=`${x}%`;
    a.style.top=`${y}%`;
}

var questions=[]
var scores=[]
for(let i=1;i<=4;i++)
{
    scores[i]=0;
}


var preX=30,preY=30;
function changeStars(x,y)
{
    // alert(`${preX},${preY},${x},${y}`)
    Xway=preX-x
    Yway=preY-y
    Xway=Xway/Math.sqrt(Xway*Xway+Yway*Yway)*Math.sqrt(2)*2*3
    Yway=Yway/Math.sqrt(Xway*Xway+Yway*Yway)*Math.sqrt(2)*2*3
    setTimeout(function(){
        Xway/=3;
        Yway/=3;
        preX=x;
        preY=y;
    },2000)
}

var questionPX=[],questionPY=[]
var maxRan=50
var isableto_nexten=0;
function testinit()
{
    generateQ();
    var qbox=document.getElementById("QContainer");
    qbox.style.zIndex="50"
    for(let i=1;i<=cntId;i++)
    {
        let ID=idQ[i]-1;
        // alert(ID)
        let x=GetRandom(3,maxRan),y=GetRandom(3,50);
        if(ID==18)
        {
            x=2;
            y=GetRandom(3,50);
        }
        questions[i]=document.createElement("div");
        questions[i].classList.add("Ques");
        setP(questions[i],x,y);
        questionPX[i]=x;
        questionPY[i]=y;


            questions[i].innerHTML=`<div class="qfcontainer">
            <svg width="100%" height="100%">
              <text class="timian" x="20" y="45">${data[ID].question}</text>
            </svg>
          </div>
          <div class="optcontainer">
            <svg width="100%" height="100%">
              <text class="option" x="30" y="50">A:${data[ID].optionA}</text>
              <text class="option" x="30" y="100">B:${data[ID].optionB}</text>
            </svg>
          </div>
          <ul class="choice-container">
            <li class="dtylist"><span class="A">A</span></li>
            <li class="dtylist"><img  class="choice" id="cc${i}_1" src="stars/star3.png" alt="star" title="star"></li>
            <li class="dtylist"><img  class="choice" id="cc${i}_2" src="stars/star3.png" alt="star" title="star"></li>
            <li class="dtylist"><img  class="choice" id="cc${i}_3" src="stars/star3.png" alt="star" title="star"></li>
            <li class="dtylist"><img  class="choice" id="cc${i}_4" src="stars/star3.png" alt="star" title="star"></li>
            <li class="dtylist"><img  class="choice" id="cc${i}_5" src="stars/star3.png" alt="star" title="star"></li>
            <li class="dtylist"><span class="B">B</span></li>
          </ul>`;
            


        let next=document.createElement("div");
        next.classList.add("next");
        next.innerHTML="确定"
        next.addEventListener("click",nexten);
        
        
        {questions[i].appendChild(next);}
        qbox.appendChild(questions[i]);
    }
    for(let i=1;i<=cntId;i++)
    {
        let cc_1=document.getElementById("cc"+i+"_1");
        let cc_2=document.getElementById("cc"+i+"_2");
        let cc_3=document.getElementById("cc"+i+"_3");
        let cc_4=document.getElementById("cc"+i+"_4");
        let cc_5=document.getElementById("cc"+i+"_5");

        cc_1.addEventListener("click",function(){
            current_judge=1;
            // alert(1)
            judgement(i);
        })
        cc_2.addEventListener("click",function(){
            current_judge=2;
            // alert(1)
            judgement(i);
        })
        cc_3.addEventListener("click",function(){
            current_judge=3;
            // alert(1)
            judgement(i);
        })
        cc_4.addEventListener("click",function(){
            current_judge=4;
            // alert(1)
            judgement(i);
        })
        cc_5.addEventListener("click",function(){
            current_judge=5;
            // alert(1)
            judgement(i);
        })
    }
}

var current_judge=3;
function judgement(ii)
{
    let cc_1=document.getElementById("cc"+ii+"_1");
    let cc_2=document.getElementById("cc"+ii+"_2");
    let cc_3=document.getElementById("cc"+ii+"_3");
    let cc_4=document.getElementById("cc"+ii+"_4");
    let cc_5=document.getElementById("cc"+ii+"_5");

    if(current_judge>1)
    {
        // cc_1.src="../stars/star1.png";
        cc_1.setAttribute("src","stars/star1.png");
        cc_1.title="star";
    }
    else if(current_judge==1)
    {
        cc_1.src="stars/star4.png";
        cc_1.title="star";
    }
    else
    {
        cc_1.src="stars/star2.png";
        cc_1.title="star";
    }

    if(current_judge>2)
    {
        // cc_1.src="../stars/star1.png";
        cc_2.setAttribute("src","stars/star1.png");
        cc_2.title="star";
    }
    else if(current_judge==2)
    {
        cc_2.src="stars/star4.png";
        cc_2.title="star";
    }
    else
    {
        cc_2.src="stars/star2.png";
        cc_2.title="star";
    }

    if(current_judge>3)
    {
        // cc_1.src="../stars/star1.png";
        cc_3.setAttribute("src","stars/star1.png");
        cc_3.title="star";
    }
    else if(current_judge==3)
    {
        cc_3.src="stars/star4.png";
        cc_3.title="star";
    }
    else
    {
        cc_3.src="stars/star2.png";
        cc_3.title="star";
    }

    if(current_judge>4)
    {
        // cc_1.src="../stars/star1.png";
        cc_4.setAttribute("src","stars/star1.png");
        cc_4.title="star";
    }
    else if(current_judge==4)
    {
        cc_4.src="stars/star4.png";
        cc_4.title="star";
    }
    else
    {
        cc_4.src="stars/star2.png";
        cc_4.title="star";
    }

    if(current_judge>5)
    {
        // cc_1.src="../stars/star1.png";
        cc_5.setAttribute("src","stars/star1.png");
        cc_5.title="star";
    }
    else if(current_judge==5)
    {
        cc_5.src="stars/star4.png";
        cc_5.title="star";
    }
    else
    {
        cc_5.src="stars/star2.png";
        cc_5.title="star";
    }
    isableto_nexten=1;
}


var current=1;
function nexten()
{
    if(isableto_nexten==1)
    {
        isableto_nexten=0;
        this.removeEventListener("click",nexten);
        scores[(current-1)%4+1]+=current_judge-3;
        // alert(scores[(current-1)%4+1])
        questions[current].style.animation="fadeout 1.5s forwards"
        if(current<cntId)
            changeStars(questionPX[current+1],questionPY[current+1])
        else
        {
            Xway=Yway=1;
        }
        setTimeout(() => {
            questions[current].style.display="none";
            current++;
            // setTimeout(function() {
                if(current<=cntId)
                {
                    // alert("c")
                    questions[current].style.display="block";
                    questions[current].style.animation="fadein 3s forwards"
                }
                else
                {
                    enden();
                }
            // }, 800);
        
        }, 1500);
    }
}

function test()
{
    cubu.style.opacity="0.4"
    testinit();
    changeStars(questionPX[current],questionPY[current])
    setTimeout(() => {
    questions[current].style.display="block";
    questions[current].style.animation="fadein 4s forwards"
    }, 2000);
}



function enden()
{
    var qbox=document.getElementById("QContainer")
    let resultbox=document.createElement("div");
    resultbox.classList.add("resultbox");
    let result="";
    result+=(scores[1]<0?'I':'E')
    result+=(scores[2]>0?'N':'S')
    result+=(scores[3]<0?'F':'T')
    result+=(scores[4]>0?'P':'J')
    resultbox.innerHTML=`Your result is<br>${result}`

    qbox.appendChild(resultbox);


    let resultlink=document.createElement("a");
    resultlink.classList.add("resultdepart");
    resultlink.innerHTML="点击查看性格简介->";
    let matched_result;
    function match(_result){
        if(_result=="ISTJ") matched_result="logistician"; 
        if(_result=="ISFJ") matched_result="defender";
        if(_result=="INFJ") matched_result="advocate"; 
        if(_result=="INTJ") matched_result="architect";
        if(_result=="ISTP") matched_result="virtuoso"; 
        if(_result=="ISFP") matched_result="adventurer";
        if(_result=="INFP") matched_result="mediator"; 
        if(_result=="INTP") matched_result="logician";
        if(_result=="ESTP") matched_result="entrepreneur"; 
        if(_result=="ESFP") matched_result="entertainer";
        if(_result=="ENFP") matched_result="campaigner"; 
        if(_result=="ENTP") matched_result="debater";
        if(_result=="ESTJ") matched_result="executive"; 
        if(_result=="ESFJ") matched_result="consul";
        if(_result=="ENFJ") matched_result="protagonist";
        if(_result=="ENTJ") matched_result="commander";
    }
    match(result);
    resultlink.href=`../introduction/${matched_result}.html`;
    // resultlink.addEventListener("click",()=>{
    //     // 啊不会写
    //     this.href="../Zerocup/INTRODUCTION.html";
    // })

    qbox.appendChild(resultlink);
}



//响应式！！！！！！！！！啊哇哇哇哇啊呜啊呜呜呜呜awawqwq
//字体来破大防

function setRemUnit() { 
    let letterSize = document.documentElement.clientWidth;
    document.getElementsByTagName("html")[0].style.fontSize = (12+letterSize / 120) + 'px'; 
}

setRemUnit();
window.addEventListener('resize', setRemUnit)
window.addEventListener('pageshow',function(e){
    if(e.persisted){
        setRemUnit()
    }
})

var titlex=100,titley=350;
title.setAttribute("x","100");
title.setAttribute("y","350");

var qidongx=999,qidongy=100;
qidong.setAttribute("x","999");
qidong.setAttribute("y","200");

function setwindowUnit() { 
    let windowSize = parseInt(window.innerWidth);

    canvas.width=window.innerWidth
    canvas.height=window.innerHeight

    titlex=120-(2000-windowSize)*0.03;
    title.setAttribute("x",`${titlex}`);

    qidongx=900-(2000-windowSize)*0.5;
    qidong.setAttribute("x",`${qidongx}`);

    maxRan=35-(2000-windowSize)*0.03;
    if(windowSize<=900)
    {
        maxRan=5;
    }


}

setwindowUnit();
window.addEventListener('resize', setwindowUnit)
// window.addEventListener('pageshow',function(e){
//     if(e.persisted){
//         setRemUnit()
//     }
// })